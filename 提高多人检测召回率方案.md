# DiariZen Segmentationæ¨¡å‹æé«˜å¤šäººæ£€æµ‹å¬å›ç‡æ–¹æ¡ˆ

## ğŸ“Š é—®é¢˜åˆ†æ

å½“å‰DiariZenæ¨¡å‹åœ¨å¤šäººæ£€æµ‹æ—¶å¯èƒ½å­˜åœ¨å¬å›ç‡ä¸è¶³çš„é—®é¢˜ï¼Œå³æŸäº›è¯´è¯äººæ²¡æœ‰è¢«æ£€æµ‹åˆ°ã€‚é€šè¿‡åˆ†æä»£ç ï¼Œå‘ç°ä»¥ä¸‹å¯ä¼˜åŒ–çš„å…³é”®ç‚¹ï¼š

### å½“å‰é™åˆ¶

1. **Binarizeé˜ˆå€¼å›ºå®š**ï¼šåœ¨`diarizen/pipelines/inference.py`ä¸­ï¼ŒBinarizeçš„onsetå’Œoffseté˜ˆå€¼å›ºå®šä¸º0.5
2. **èšç±»å‚æ•°ä¿å®ˆ**ï¼šé»˜è®¤çš„èšç±»å‚æ•°å¯èƒ½è¿‡äºä¿å®ˆï¼Œå¯¼è‡´è¯´è¯äººè¢«åˆå¹¶
3. **æœ€å¤§è¯´è¯äººæ•°é™åˆ¶**ï¼šé»˜è®¤max_speakerså¯èƒ½è®¾ç½®è¿‡ä½

## ğŸ¯ ä¼˜åŒ–ç­–ç•¥

### 1. é™ä½Binarizeé˜ˆå€¼ï¼ˆæœ€é‡è¦ï¼‰

**ä½ç½®**ï¼š`diarizen/pipelines/inference.py` ç¬¬276-280è¡Œ

**å½“å‰è®¾ç½®**ï¼š
```python
to_annotation = Binarize(
    onset=0.5,      # å¼€å¯é˜ˆå€¼
    offset=0.5,     # å…³é—­é˜ˆå€¼
    min_duration_on=0.0,
    min_duration_off=0.0
)
```

**ä¼˜åŒ–å»ºè®®**ï¼š
- **æé«˜å¬å›ç‡**ï¼šé™ä½onsetå’Œoffsetï¼ˆå¦‚0.3-0.4ï¼‰
  - onset=0.3, offset=0.3ï¼šæ›´æ•æ„Ÿï¼Œèƒ½æ£€æµ‹åˆ°æ›´å¤šè¯´è¯äººç‰‡æ®µ
  - onset=0.35, offset=0.35ï¼šå¹³è¡¡è®¾ç½®
- **é™ä½è¯¯æ£€**ï¼šæé«˜onsetå’Œoffsetï¼ˆå¦‚0.6-0.7ï¼‰
  - onset=0.6, offset=0.6ï¼šæ›´ä¿å®ˆï¼Œå‡å°‘è¯¯æ£€

**åŸç†**ï¼š
- onseté˜ˆå€¼æ§åˆ¶ä½•æ—¶å¼€å§‹æ ‡è®°ä¸ºæ´»è·ƒè¯´è¯äºº
- offseté˜ˆå€¼æ§åˆ¶ä½•æ—¶åœæ­¢æ ‡è®°
- é™ä½é˜ˆå€¼ = æ›´æ•æ„Ÿ = æ›´é«˜å¬å›ç‡ï¼ˆä½†å¯èƒ½å¢åŠ è¯¯æ£€ï¼‰

### 2. è°ƒæ•´èšç±»å‚æ•°

**ä½ç½®**ï¼šé€šè¿‡`config.toml`æˆ–`config_parse`å‚æ•°

#### VBxClusteringå‚æ•°

```python
clustering_config = {
    "method": "VBxClustering",
    "Fa": 0.05,              # é™ä½å¯æé«˜æ•æ„Ÿåº¦ï¼ˆæ¨è0.03-0.05ï¼‰
    "Fb": 0.7,               # é™ä½å¯å€¾å‘æ›´å¤šè¯´è¯äººï¼ˆæ¨è0.6-0.8ï¼‰
    "ahc_threshold": 0.5,   # é™ä½å¯äº§ç”Ÿæ›´å¤šåˆå§‹èšç±»ï¼ˆæ¨è0.5-0.6ï¼‰
    "lda_dim": 128,
    "max_iters": 25,         # å¢åŠ è¿­ä»£æ¬¡æ•°æé«˜ç²¾åº¦
    "min_speakers": 1,
    "max_speakers": 30       # å¢åŠ æœ€å¤§è¯´è¯äººæ•°
}
```

**å‚æ•°è¯´æ˜**ï¼š
- **Fa**ï¼šå…ˆéªŒæ¦‚ç‡å‚æ•°ï¼Œè¶Šå°è¶Šæ•æ„Ÿï¼ˆæ¨èèŒƒå›´ï¼š0.03-0.08ï¼‰
- **Fb**ï¼šè¯´è¯äººæ•°é‡æ§åˆ¶ï¼Œè¶Šå°å€¾å‘æ›´å¤šè¯´è¯äººï¼ˆæ¨èèŒƒå›´ï¼š0.6-0.9ï¼‰
- **ahc_threshold**ï¼šåˆå§‹èšç±»é˜ˆå€¼ï¼Œè¶Šå°äº§ç”Ÿæ›´å¤šèšç±»ï¼ˆæ¨èèŒƒå›´ï¼š0.5-0.7ï¼‰

#### AgglomerativeClusteringå‚æ•°

```python
clustering_config = {
    "method": "AgglomerativeClustering",
    "ahc_threshold": 0.6,    # é™ä½å¯äº§ç”Ÿæ›´å¤šè¯´è¯äººï¼ˆæ¨è0.5-0.7ï¼‰
    "min_cluster_size": 5,   # é™ä½å¯ä¿ç•™æ›´å¤šå°èšç±»ï¼ˆæ¨è5-10ï¼‰
    "min_speakers": 1,
    "max_speakers": 30
}
```

### 3. è°ƒæ•´Segmentationå‚æ•°

**ä½ç½®**ï¼šé€šè¿‡`config.toml`çš„`inference.args`

```python
inference_config = {
    "segmentation_step": 0.1,           # ä¿æŒé»˜è®¤
    "batch_size": 32,
    "apply_median_filtering": True,    # å¯å°è¯•Falseçœ‹æ•ˆæœ
}
```

**æ³¨æ„**ï¼šDiariZenä½¿ç”¨powersetç¼–ç ï¼Œsegmentationå‚æ•°åªæœ‰`min_duration_off`å¯é€šè¿‡pipelineå‚æ•°è°ƒæ•´ã€‚

### 4. å¢åŠ æœ€å¤§è¯´è¯äººæ•°

**å…³é”®å‚æ•°**ï¼š
```python
clustering_config = {
    "max_speakers": 30,  # æ ¹æ®å®é™…åœºæ™¯è°ƒæ•´ï¼ˆé»˜è®¤å¯èƒ½æ˜¯20ï¼‰
    "min_speakers": 1,
}
```

## ğŸ”§ å®æ–½æ­¥éª¤

### æ–¹æ¡ˆAï¼šä¿®æ”¹ä»£ç æ”¯æŒå¯é…ç½®Binarizeé˜ˆå€¼ï¼ˆæ¨èï¼‰

1. ä¿®æ”¹`diarizen/pipelines/inference.py`ï¼Œä½¿Binarizeé˜ˆå€¼å¯é…ç½®
2. ä¿®æ”¹`batch_diarize_with_vad_preprocessing.py`ï¼Œæ·»åŠ å‘½ä»¤è¡Œå‚æ•°
3. é€šè¿‡å‚æ•°ä¼ é€’é…ç½®

### æ–¹æ¡ˆBï¼šç›´æ¥ä¿®æ”¹ç¡¬ç¼–ç å€¼ï¼ˆå¿«é€Ÿæµ‹è¯•ï¼‰

ç›´æ¥ä¿®æ”¹`diarizen/pipelines/inference.py`ä¸­çš„Binarizeé˜ˆå€¼ï¼Œå¿«é€ŸéªŒè¯æ•ˆæœã€‚

### æ–¹æ¡ˆCï¼šé€šè¿‡config_parseè°ƒæ•´èšç±»å‚æ•°

åœ¨åˆ›å»ºpipelineæ—¶ä¼ å…¥è‡ªå®šä¹‰é…ç½®ã€‚

## ğŸ“ˆ é¢„æœŸæ•ˆæœ

### æé«˜å¬å›ç‡çš„å‚æ•°ç»„åˆ

**æ¿€è¿›è®¾ç½®ï¼ˆæœ€å¤§åŒ–å¬å›ç‡ï¼‰**ï¼š
```python
binarize_onset = 0.3
binarize_offset = 0.3
clustering_config = {
    "method": "VBxClustering",
    "Fa": 0.03,
    "Fb": 0.6,
    "ahc_threshold": 0.5,
    "max_speakers": 30
}
```

**å¹³è¡¡è®¾ç½®ï¼ˆå¬å›ç‡ä¸ç²¾åº¦å¹³è¡¡ï¼‰**ï¼š
```python
binarize_onset = 0.4
binarize_offset = 0.4
clustering_config = {
    "method": "VBxClustering",
    "Fa": 0.05,
    "Fb": 0.7,
    "ahc_threshold": 0.6,
    "max_speakers": 25
}
```

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **å¬å›ç‡ vs ç²¾åº¦æƒè¡¡**ï¼šæé«˜å¬å›ç‡å¯èƒ½å¢åŠ è¯¯æ£€
2. **è®¡ç®—æˆæœ¬**ï¼šå¢åŠ max_speakerså’Œmax_itersä¼šå¢åŠ è®¡ç®—æ—¶é—´
3. **åœºæ™¯é€‚é…**ï¼šä¸åŒåœºæ™¯ï¼ˆä¼šè®®ã€å¯¹è¯ã€æ’­å®¢ï¼‰éœ€è¦ä¸åŒå‚æ•°
4. **éªŒè¯æ–¹æ³•**ï¼šå»ºè®®åœ¨éªŒè¯é›†ä¸Šæµ‹è¯•ä¸åŒå‚æ•°ç»„åˆï¼Œé€‰æ‹©æœ€ä¼˜è®¾ç½®

## ğŸ§ª æµ‹è¯•å»ºè®®

1. **åŸºçº¿æµ‹è¯•**ï¼šä½¿ç”¨å½“å‰é»˜è®¤å‚æ•°å¤„ç†æ ·æœ¬éŸ³é¢‘
2. **å•å‚æ•°è°ƒä¼˜**ï¼šé€ä¸€è°ƒæ•´å…³é”®å‚æ•°ï¼Œè§‚å¯Ÿæ•ˆæœ
3. **ç»„åˆä¼˜åŒ–**ï¼šåœ¨æœ‰æ•ˆå‚æ•°èŒƒå›´å†…è¿›è¡Œç½‘æ ¼æœç´¢
4. **äº¤å‰éªŒè¯**ï¼šåœ¨å¤šä¸ªéŸ³é¢‘æ ·æœ¬ä¸ŠéªŒè¯å‚æ•°ç¨³å®šæ€§

## ğŸ“ å‚è€ƒæ–‡æ¡£

- `DiariZenæŠ€æœ¯æ–‡æ¡£.md`ï¼šç¬¬1600-1800è¡Œæœ‰è¯¦ç»†çš„èšç±»å‚æ•°è¯´æ˜
- `pyannote-audio/pyannote/audio/utils/signal.py`ï¼šBinarizeå®ç°ç»†èŠ‚
- `diarizen/pipelines/inference.py`ï¼šDiariZen pipelineå®ç°

